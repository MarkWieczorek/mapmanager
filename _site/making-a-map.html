<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Map Manager : Making a map</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/mapmanager/css/syntax.css">
        <link rel="stylesheet" href="/mapmanager/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <div class=no-print>

<div style="float: right;"><A HREF="search.html">Search...</A></div>

<h4>
	<a class=brand href="/mapmanager/">Map Manager</a>
    <small></small>
</h4>


<!--
<div float=right>
<a href="javascript:window.print()" float=right>print</a>
</div>
-->



</div>

                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <!-- <li><a href="/mapmanager/">Home</a></li> -->
    <BR>
    
    
        
        

        
            
                <li class=nav-header>Workflows</li>
            
            <li data-order="1"><a href="/mapmanager/getting-started">Getting started</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/making-a-map">Making a map</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/annotating-a-stack">Annotating a stack</a></li>
        
    
        
        

        
            
                <li class=nav-header>Imaging Core</li>
            
            <li data-order="3"><a href="/mapmanager/stack-annotations">Stack Annotations</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/buttons">Buttons</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/stack">Stack</a></li>
        
    
        
        

        
            
                <li class=nav-header>Interface Windows</li>
            
            <li data-order="4"><a href="/mapmanager/point-list">Point List</a></li>
        
            
            <li data-order="5"><a href="/mapmanager/find-points-panel">Find Points</a></li>
        
            
            <li data-order="8"><a href="/mapmanager/hdd-paths">Hard Drive Paths</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/time-series-panel">Time Series</a></li>
        
            
            <li data-order="7"><a href="/mapmanager/stackdb-options-panel">Options</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/search-panel">Search</a></li>
        
            
            <li data-order="10"><a href="/mapmanager/plot-panel">Plot panel</a></li>
        
            
            <li data-order="9"><a href="/mapmanager/layout-panel">Layout panel</a></li>
        
            
            <li data-order="6"><a href="/mapmanager/contrast-panel">Contrast panel</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/stack-browser">Stack Browser</a></li>
        
    
        
        

        
            
                <li class=nav-header>Plots</li>
            
            <li data-order="1"><a href="/mapmanager/stack-plot">Stack plot</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/run-plot">Run plot</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/map-plot">Map plot</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analysis</li>
            
            <li data-order="4"><a href="/mapmanager/Map-Pool">Map Pool</a></li>
        
            
            <li data-order="4"><a href="/mapmanager/Plotting">Plotting</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/Algorithms">Algorithms</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/reports">Reports</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/intensity">Intensity</a></li>
        
    
        
        

        
            
                <li class=nav-header>Blog Posts</li>
            
            <li data-order="2"><a href="/mapmanager/map-manager-matlab">Matlab class library</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/fiji-plugins">Fiji plugins</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/release-notes">Release Notes</a></li>
        
            
            <li data-order="5"><a href="/mapmanager/gallery">Gallery</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/faq">FAQ</a></li>
        
            
            <li data-order=""><a href="/mapmanager/file-format">File format</a></li>
        
    


<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

<!--    <A HREF="search.html">Search...</A> -->

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h3>Making a map
        
    </h3>
</div>

<p><img class="img-float-left" src="images/mm3/time-series/time-series-panel.png" width="650" /></p>

<div class="print-page-break"></div>

<p>A map is a time-series of <a href="stack">stacks</a>. You create a map by appending stacks from the <a href="stack-browser">stack browser</a>. Once a map is made it can be saved, re-opened, annotated, and browsed using the <a href="time-series-panel">time-series panel</a>.</p>

<p>The time-series panel shows a list of open maps on the left. When a map is selected (het3b in this example), a list of sessions in the map are shown on the right (in this example there are 12 sessions).</p>

<h3 id="pre-process-your-raw-data">Pre-process your raw data</h3>
<p>Map Manager will only import single channel .tif stacks. If your stacks have two or more color channels, they need to be de-interleaved into separate .tif files, one .tif file per color channel. We have <a href="fiji-plugins">Fiji plugins</a> to do exactly this for Zeiss LSM/CZI, Prairie View, and ScanImage.</p>

<ul>
  <li>ScanImage, use <strong><a href="fiji-plugins">bAlignBatch</a></strong></li>
  <li>Zeiss, use <strong><a href="fiji-plugins">bFolder2MapManager</a></strong></li>
  <li>Prairie, use <strong><a href="fiji-plugins">bPrairie2tif</a></strong></li>
</ul>

<h3 id="open-and-initialize-map-manager">1. Open and initialize Map Manager</h3>

<p class="important"><b>Important.</b> Map Manager will only work with Igor Pro 6. Please make sure you have Igor Pro 6 or <a href="https://www.wavemetrics.com/order/order_igordownloads6.htm">download a trial version of Igor Pro 6.3</a>.
</p>

<ol>
  <li>Open Igor Pro with MapManager.ipf</li>
  <li>Click on the empty command window to activate Map Manager and its menus</li>
  <li>Open the <a href="stack-browser">stack browser</a> window with menu ‘MapManager - Stack Browser’.</li>
  <li>Open the <a href="time-series-panel">time-series</a> window with menu ‘MapManager - Time series’.</li>
</ol>

<h3 id="make-a-new-map">2. Make a new map</h3>
<p>In the time-series window ‘Map Making’ tab</p>

<ol>
  <li>Enter a new map name.</li>
  <li>Set the number of channels for each stack in your map</li>
  <li>Create a new map with ‘<span style="color:green">New Map</span>’.</li>
</ol>

<h4 id="appending-stacks-to-your-map">2.1 Appending stacks to your map</h4>
<ol>
  <li>In the stack browser, select the stack you want to append to a map. If your stacks have more than one color channel, you can select any of the color channels.</li>
  <li>In the time-series panel ‘Map Making’ tab, press ‘Append Stack’ button.</li>
  <li>Repeat for each stack you want in your map.</li>
</ol>

<h4 id="span-stylecolorredimportantspan"><span style="color:red">Important</span></h4>
<ul>
  <li><strong>Number of channels is important.</strong> When you make a map, you need to choose the ‘Number Of Channels’. Map Manager will only allow one choice of ‘Number Of Channels’ per map. You cannot mix stacks with different numbers of channels within a map.</li>
  <li><strong>Stack scale is important.</strong> Make sure the scale of each imported stack is correct. It is hard to change the scale later. If you use the provided Fiji plugins this should be taken care of. If necessary, set the scale of a stack in its stack window with <kbd>shift</kbd>+<kbd>p</kbd>.</li>
  <li><strong>The order of stacks is important.</strong> Make sure the timepoints in your map are imported in the correct order. It is hard to change the order later.</li>
</ul>

<h4 id="saving-a-map">2.2 Saving a map</h4>

<p>Save the map with ‘Save Map’ button. New maps are saved to a default hard-drive folder specified in the <a href="hdd-paths">Hard Drive Paths</a> panel.</p>

<h4 id="opening-a-map">2.3 Opening a map</h4>

<p>Open a Map Manager map using the ‘Open Map’ button in the <a href="time-series-panel">time-series</a> panel. When you open a map named ‘mymap’, you need to open the file ‘mymap.ipf’.</p>

<h4 id="congratulations-you-just-made-a-map-manager-map">2.4 Congratulations, you just made a Map Manager map.</h4>

<p>The rest of this workflow covers tracing dendritic segments, adding spines, and connecting spines across timepoints. Before you do any of this, play with the stacks in your map. From the time-series window, open a run of stacks by right-clicking on a session and selecting ‘Plot Run +- 1’.</p>

<h3 id="create-dendritic-tracings">3. Create dendritic tracings</h3>

<p>Dendritic tracings are specified with control points and then fit using a custom Fiji plugin. Before fitting a line in Fiji, you need to specify the path to your Fiji application in the <a href="hdd-paths">Hard Drive Paths</a> panel.</p>

<ol>
  <li><strong>Open a <a href="stack">stack</a> window.</strong> In the time-series panel, double-click the first session in your map.</li>
  <li><strong>Create a line segment.</strong> See instruction in stack annotations <a href="stack-annotations#creating-line-segments">‘Creating and editing line segments’</a>.
    <ul>
      <li>Turn on the ‘Segment’ edit checkbox.</li>
      <li>Click the ‘+’ button to create a new (empty) segment.</li>
      <li>Create Control Points along a segment with shift+click. Remember, all points are in 3D, make sure the control points are in the center of the segment and in the correct imaging plane. Ctrl+mouse wheel to zoom, click+drag to pan.</li>
      <li>Delete control points with right-click menu ‘Delete’.</li>
      <li>Move control points with right-click menu ‘Move’.</li>
      <li>Once control points are made, fit the backbone line in Fiji. Right-click on your segment in the list and select ‘Make from control points - Fiji’.</li>
    </ul>
  </li>
  <li>Repeat steps # 1 and # 2 for each session in your map. Making the same line segment in each session. As you make control points, be sure they are in the same direction along the segment for each session.</li>
  <li><strong>Set a pivot point in each line segment.</strong> Click a point in the segment, right-click and select ‘Set As Segment Pivot’ menu.</li>
</ol>

<p><strong>Pivot Points.</strong> The pivot point in each segment should refer to the same region of the segment across all session. A good strategy is to choose a region of the segment near an obvious spine that is present in all sessions. Another strategy is to choose a pivot point where some other segment (dendrite) crosses near your segment as these tend to remain stable across time. Try and put the pivot point near the center of the segment, do not place it at either end. The pivot point is used to calculate a line distance along the segment (in um) which in turn will be used to auto-guess connections between spines across sessions.</p>

<p class="tip"><b>Tip.</b> When specifying control points and setting segment pivots, you can open multiple stack windows at the same time. Just double-click on each session in the time-series panel. This way, you can see the line segments you are making in each session of your map.</p>

<h3 id="connect-your-line-segments-together">4. Connect your line segments together</h3>
<ol>
  <li>Close all stack windows using the <span style="color:blue">Close Windows</span> button in the time-series panel.</li>
  <li>Open a new stack run by right-clicking a session in your map and selecting the ‘<strong>Plot Run +- All</strong>’ menu.</li>
  <li>Turn on the ‘Segments’ edit checkbox in the left control bar of a stack window. Open the left control bar with keyboard <kbd>[</kbd>.</li>
  <li>Sequentialy connect your line segment from one timepoint to the next
    <ul>
      <li>Select the <strong>source</strong> timepoint segment (for example, timepoint 1). Make sure you select a point on the segment backbone line.</li>
      <li>Select the <strong>destination</strong> timepoint segment (for example, timepoint 2). Again, make sure you select a point on the segment backbone line.</li>
      <li>In the <strong>destination</strong> timepoint window (e.g. timepoint 2), press keyboard <kbd>p</kbd> for persistent (or use right-click menu ‘Dynamics - Make Object Persistent’).</li>
    </ul>
  </li>
</ol>

<p class="tip"><b>Tip.</b> You can see how your segments are connected by plotting a 'Segment Map' from the time-series panel. In the segment map window, right-click a segent and select 'Plot Run' to plot a run of segments.</p>

<h3 id="mark-spines-in-each-timepoint">5. Mark spines in each timepoint</h3>
<ol>
  <li>Open a single timepoint <a href="stack">stack</a> window by double clicking a session in the time-series window.</li>
  <li>Make sure ‘Segments’ edit checkbox is off.</li>
  <li>See <a href="stack-annotations">stack annotations</a> to mark spines along your new segment.
    <ul>
      <li>Select the segment to add a spine to by selecting it in the list of segments or single click a point along the tracing (in the image).</li>
      <li><strong>Create</strong> a spine with shift+click. The spine should be marked at the membrane limit of the spine head, somewhere near the tip of the spine. Remember, all points are in 3D, take care in creating the spine in the correct image plane.</li>
      <li><strong>Move</strong> a spine with right-click ‘Move’.</li>
      <li><strong>Delete</strong> a spine with right-click ‘Delete’ or keyboard <kbd>delete</kbd>.</li>
      <li>All spines are automatically connected to the dendritic segment with a line. Edit the connection point with right-click ‘Manual Connect’.</li>
    </ul>
  </li>
</ol>

<p class="tip"><b>Tip.</b> Be very liberal in your scoring, mark anything you think might be a spine. All annotations can be flagged as 'bad' using the right-click menu 'bad'. Bad objects stay in the database but are **not** included in the final analysis. As your datasets grow, marking putative spines with an annotation and then as bad allows you to return to a given image stack and see you already decided **not** to include a putative spine in your analysis.</p>

<h3 id="edit-the-dynamics-of-annotations-between-timepoints">6. Edit the dynamics of annotations between timepoints</h3>

<h4 id="editing-annotation-dynamics-manually-from-a-run-plot">6.1 Editing annotation dynamics manually from a run plot</h4>

<h5 id="opening-a-run-plot">Opening a run plot</h5>

<ul>
  <li>Open an object map from the time-series panel ‘Object Map’ button</li>
  <li>In the object map, right-click an annotation and select ‘Plot Run +` 1’.</li>
  <li>In a stack window in the run, control+click an annotation to snap all stacks in the run to the same image position. This will also automatically select all annotations that are persistent with the one you control+clicked.</li>
  <li>Once a spine is selected, use <kbd>ctrl</kbd>+<kbd>left arrow</kbd> and <kbd>ctrl</kbd>+<kbd>right arrow</kbd> to select the next spine along the tracing. As you do this, the other stack windows in the run will snap to the same image position and automatically select spines that have been marked as persistent.</li>
</ul>

<h5 id="editing-dynamics-in-a-run-plot">Editing dynamics in a run plot</h5>

<ul>
  <li><strong>Mark an annotation as addition.</strong> Select the annotation and press keyboard <kbd>a</kbd>.</li>
  <li><strong>Mark an annotation as subtraction.</strong> Select the annotation and press keyboard <kbd>s</kbd>.</li>
  <li><strong>Mark two annotations as persistent.</strong> Select the annotation in the source timepoint, then select the desired annotation in the destination timepoint. In the destination timepoint, press keyboard <kbd>p</kbd>.</li>
</ul>

<p>As you edit the dynamics between annotations, all connections are automatically maintained. For example, marking an annotation as addition will automatically disconnect it from any previous annotation it was marked as persistent with.</p>

<p>Before you make any edits to an annotation, it is both added and subtracted by default (e.g. transient). Annotations in the first timepoint can never be marked as added. Likewise, annotations in the final timepoint can never be marked as subtraction.</p>

<h4 id="editing-annotation-dynamics-with-find-points16">6.2 Editing annotation dynamics with <a href="find-points-panel">Find Points</a></h4>

<p><span style="color:red">WARNING: As of 20171023, the interface to find point is a bit broken</span></p>

<p>The dynamics of annotations can be edited using the <a href="find-points-panel">Find Points</a> panel. This is done pair-wise between timepoints. For example, if your map has 4 sessions, you will use Find Points first between session 1 and 2, then between sessions 2 and 3, and finally between sessions 3 and 4.</p>

<p>The Find Points panel will generate an automatic guess for the best connections and allow you to set them manually. This automatic guess is using the pivot point in your dendritic segment, if this pivot point does not correspond to a similar region of the segment between timepoints, the guess will be incorrect.</p>

<ol>
  <li>Close all stack windows with ‘Close Windows’ button in time-series panel.</li>
  <li>Open the <a href="find-points-panel">Find Points Pane</a> by right-clicking the first session in your map and selecting ‘Find Points’.</li>
  <li>In the Find Points panel, you are given a list of all annotations in the source timepoint. Click on a spine in the list and Find Points will open both the source and destination timepoints, zoomed onto that spine.</li>
</ol>

<p>This is the core of Map Manager and you will spend most of your time doing this.</p>

<h3 id="curating-your-connected-objects">7. Curating your connected objects</h3>

<h4 id="review-your-work-by-using-search-to-query-all-addition-subtraction-and-transient">7.1 Review your work by using search to query all addition, subtraction and transient</h4>

<ul>
  <li>Open the <a href="search-panel">search panel</a> from the time-series panel with the ‘Search’ button.</li>
  <li>Search for added annotations with the ‘Addition’ button. The ‘Addition’ button is in the ‘Map’ tab.</li>
  <li>All added annotations will appear as a list in the search results.</li>
  <li>Right-click on an annotation and select ‘plot run +- 1’ to bring up a spine run.</li>
  <li>Visually check that you agree the annotation is an addition and edit if necessary. Once you are in a run plot, you can always add and delete annotations, and edit the dynamics manually.</li>
  <li>Do the same by searching for ‘Subtraction’ and then ‘Transient’</li>
</ul>

<h4 id="browse-the-connections-visually-and-edit-as-necessary">7.2 Browse the connections visually and edit as necessary</h4>

<p><span style="color:red">This is a repeat of what we already described above</span></p>

<p>You need to verify the connectivity of annotations between <strong>all</strong> timepoints in the map. If your map has 4 timepoints, you need to verify the annotation connections between timepoint 1-2, timepoint 2-3, and timepoint 3-4.</p>

<ul>
  <li>Open a <a href="run-plot">run plot</a> of three sequential timepoints by right-clicking a spine in the object map and selecting ‘plot run +- 1’. Open an object map with the ‘Object Map’ button in the time-series panel.</li>
  <li>In the run plot windows, select an annotation in the middle timepoint with ctrl+click. This will snap and zoom the annotations and its associated connections in all windows of the run plot. If there is no annotation in a given timepoint, the image will be snapped to where the annotation ‘would-be’. This is using segment pivot points, if they are not specified or poorly marked, this snapping will not work.</li>
  <li>From the middle timepoint spine selection, go to the next spine along the segment using keyboard <kbd>ctrl</kbd>+<kbd>right arrow</kbd>. Go to the previous spine along the segment using keyboard <kbd>ctrl</kbd>+<kbd>left arrow</kbd>.</li>
  <li>Correct any errors in the spine dynamics using keyboard <kbd>a</kbd> for addition, <kbd>s</kbd> for subtraction, and <kbd>p</kbd> for persistence. See <a href="run-plot">run plot</a> for details.</li>
</ul>

<h3 id="there-are-many-many-more-features">There are many many more features</h3>

<ul>
  <li>See <a href="reports">reports</a> for details on generating reports of spine density and dynamics.</li>
  <li>See <a href="intensity">intensity</a> for details on spine intensity analysis.</li>
</ul>



<div class="post-tags">
  
  
  
    <b>Tags:</b>  
  
  
  
    <a href="/mapmanager/tags/#Workflow">Workflow</a>
  

   <!--
   <a href="javascript:window.print()">print</a>
    -->

   <!--
   <BR>
   <a href="_posts/2015-04-20-making-a-map.pdf">print pdf</a>
   <BR>
   -->
    
</div>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                      Copyright &copy; 2017 - Robert Cudmore -

 <a href="http://robertcudmore.org/index.html">robertcudmore.org</a>

<!--
Documentation for <a href="https://github.com/cudmore/mapmanager">Map Manager</a>
-->
                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                    
                    //console.log(order, li);
                }

                //20160327 removed, this was no doing anything???
                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    //console.log(section);
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
