<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Map Manager : Annotating a stack</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/mapmanager/css/syntax.css">
        <link rel="stylesheet" href="/mapmanager/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <div class=no-print>
<h4><a class=brand href="/mapmanager/">Map Manager</a>
    <small></small>
</h4>

<!--
<div float=right>
<a href="javascript:window.print()" float=right>print</a>
</div>
-->

</div>

                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <!-- <li><a href="/mapmanager/">Home</a></li> -->
    <BR>
    
    <li class=nav-header><A HREF="search.html">Search ...</A></li>
    
    
        
        

        
            
                <li class=nav-header>Workflows</li>
            
            <li data-order="5"><a href="/mapmanager/gallery">Gallery</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/getting-started">Getting started</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/making-a-map">Making a map</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/annotating-a-stack">Annotating a stack</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/simple-stack-db">Simple stack database</a></li>
        
    
        
        

        
            
                <li class=nav-header>Imaging Core</li>
            
            <li data-order="3"><a href="/mapmanager/stackdb-plot">Stack DB plot</a></li>
        
            
            <li data-order="4"><a href="/mapmanager/scale-panel">Scale panel</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/process-panel">Process panel</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/stack-browser">Stack Browser</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/stack">Stack</a></li>
        
    
        
        

        
            
                <li class=nav-header>Interface Windows</li>
            
            <li data-order="4"><a href="/mapmanager/find-points-panel">Find Points</a></li>
        
            
            <li data-order="6"><a href="/mapmanager/hdd-paths">Hard Drive Paths</a></li>
        
            
            <li data-order="5"><a href="/mapmanager/stackdb-options-panel">Options</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/search-panel">Search panel</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/plot-panel">Plot panel</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/main-panel">Main panel</a></li>
        
    
        
        

        
            
                <li class=nav-header>Plots</li>
            
            <li data-order="1"><a href="/mapmanager/stack-plot">Stack plot</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/run-plot">Run plot</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/map-plot">Map plot</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analysis</li>
            
            <li data-order="1"><a href="/mapmanager/stack-analysis">Stack report</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/spine-dynamics">Map report</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/intensity">Intensity</a></li>
        
    
        
        

        
            
                <li class=nav-header>Blog Posts</li>
            
            <li data-order="2"><a href="/mapmanager/faq">FAQ</a></li>
        
            
            <li data-order=""><a href="/mapmanager/File-format">File format</a></li>
        
            
            <li data-order=""><a href="/mapmanager/fitting-segments-in-fiji">Fitting segments in Fiji</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/user-files">User files</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/database-overview">Database overview</a></li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h3>Annotating a stack
        
    </h3>
</div>

<p><img class="img-float-left" src="images/mm3/mm3-stackdb-plot.png" width="500" /></p>

<div class="print-page-break"></div>

<p>Stacks are annotated with 3D objects and line segments. Taken together, these 3D objects and line segments make a stack database (<strong>stack db</strong>).</p>

<p>This example shows a stack window and its stack db with three line segments and a number of 3D objects, spines in this case.</p>

<p>Open the stack db interface from any <a href="stack">stack</a> window using keyboard ‘[’</p>

<h3 id="creating-3d-objects">Creating 3D objects</h3>

<p>Choose the type of object in the ‘New Object’ group and shift+click in the image to create the object.</p>

<p><img class="img-float-right" src="images/mm3/mm3-object-types.png" width="100" /><br />
- <strong>Spine</strong> : A spine is always connected to a segment (its parent segment). You can only create a spine if you first select the segment that will be its parent.  <br />
- <strong>Bouton</strong> : This also requires a parent  <br />
- vBranch :  <br />
- soma :  <br />
- peri :  <br />
- <strong>controlPnt</strong> : Points along a segment that are used to fit a line in FIJI. <br />
- other :</p>

<p>The different names allow you to organize your annotations into different groups. These groups can then be <a href="search-panel">searched</a>, <a href="plot-panel">plotted</a> and connect together in a <a href="map-plot">map</a>.</p>

<p class="tip"><b>Tip.</b> All objects are 3D points. To create a new point with better precision, zoom in the stack window with keyboard '+'. The zoom will follow the mouse pointer. Zoom out again with keyboard '-' and return to the full view with keyboard 'enter'.
</p>

<h4 id="selecting-an-object">Selecting an object</h4>

<ul>
  <li>Single-click on the object. Selected object will appear as yellow circles. PRess keyboard ‘esc’ to cancel a selection.</li>
</ul>

<h4 id="moving-an-object">Moving an object</h4>

<ul>
  <li>Select the object (single click), right-click and select ‘Move’. Your next click will be the new 3D position of the object. You are given feedback in the bottom of the stack window. Press ‘esc’ to cancel a move.</li>
</ul>

<h4 id="deleting-an-object">Deleting an object</h4>

<ul>
  <li>Select the object (single click), right-click and select ‘Delete’.</li>
  <li>Select the object (single-click) and hit the ‘del’ key.</li>
</ul>

<h3 id="creating-line-segments">Creating line segments</h3>

<p>Existing line segments are listed in the ‘Line Segment’ group. Each line segment has a length (um), a number of objects (nObj), a radius (r), and a color (c).</p>

<p>Line segments are created as follows:</p>

<ol>
  <li>Make sure ‘Edit Segments ‘ is turned on.</li>
  <li>
    <p>Create a new (empty) line segment  <br />
  Click ‘+’ button in the ‘Line Segment’ group. This will create an empty line segment.</p>
  </li>
  <li>Make a series of 3D <strong>control point</strong> objects along your dendrite/axon
    <ul>
      <li>Select ‘New Object -&gt; Other -&gt; Control Point’</li>
      <li>Shift-click in the image to create a <strong>control point</strong>.</li>
      <li>Continue making <strong>control points</strong> along the desired line segment in the image.</li>
    </ul>
  </li>
  <li>Fit the line in FIJI and import the resulting line segment back into map manager
    <ul>
      <li>Right-click on the new line segment (in the top left list) and select ‘Make From Control Points - FIJI’. This will open the xxx plugin in FIJI, fit a line to your <strong>control points</strong> and open the fitted line segment in the map manager stack window.</li>
    </ul>
  </li>
</ol>

<p><strong>Important:</strong> When making control points, they need to be in order along a segment. If you ‘double-back’ a control point on the segment, the line fit with dumbly follow this ordering of control points. For help on the ordering of your control points, open the ‘options’ panel and turn on ‘Control Point Help’ with the ‘On’ button. If it all gets confusing you can just delete all your control points and start over.</p>

<p><strong>Important:</strong> When making a map, you will be associating individual line segments  from one session to the next. For segments that you will connect together in a map, make sure your control points are in the same general direction along each segment. If your control points go left to right in session 1, they should also go left to right in session 2.</p>

<h3 id="line-segment-radius">Line segment radius</h3>

<p>Each line segment has a fixed radius in um. Spines are connected to this radius.</p>

<p>To change the radius, double-click the radius for a segment and enter a new number. The radius of each segment is displayed in the ‘r’ column.</p>

<p>Setting the radius will reconnect all your spines to that new radius while preserving the spine connection point to the line.</p>

<p>To set all the radii of a run of connected segments, right click on the segment in the list and select ‘Set run to same radius’.</p>

<h3 id="line-segment-pivot-points">Line segment pivot points</h3>

<p>When in a map, line segments need a ‘pivot point’. Specify a pivot point for a segment by clicking a point in the segment, right-click and select the ‘Set As Segment Pivot’ menu.</p>

<p>The pivot point should specify a region of the segment that is the same in all sessions. A good strategy is to choose a region of the segment near an obvious spine that is present in all sessions. Another strategy is to choose a pivot point where some other segment (dendrite) crosses near your segment as these tend to remain stable across time. Try and put the pivot point near the center of the segment, do not place it at either end. The pivot point is used to calculate a line distance along the segment (in um) which in turn will be used to auto-guess connections between objects (spines) across sessions.</p>



<div class="post-tags">
  
  
  
    <b>Tags:</b>  
  
  
  
    <a href="/mapmanager/tags/#Workflow">Workflow</a>
  

   <!--
   <a href="javascript:window.print()">print</a>
    -->

   <!--
   <BR>
   <a href="_posts/2015-04-20-annotating-a-stack.pdf">print pdf</a>
   <BR>
   -->
    
</div>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                      Copyright &copy; 2016 - Robert Cudmore -

 <a href="http://robertcudmore.org/index.html">robertcudmore.org</a>

<!--
Documentation for <a href="https://github.com/cudmore/mapmanager">Map Manager</a>
-->
                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                //20160327 removed, this was no doing anything???
                //for (var i = 0; i < sections.length; i++) {
                 //   section = sections[i];
                 //   console.log(section);
                 //   list = lists[section].sort(function(a, b) {
                 //       return a[0] - b[0];
                 //   });

                 //   if (header = headers[section]) {
                 //       navUl.appendChild(header);
                 //   }
                 //   for (var j = 0; j < list.length; j++) {
                 //       navUl.appendChild(list[j][1]);
                 //   }
                //}
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
