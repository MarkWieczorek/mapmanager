<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>Map Manager : Stack Annotations</title>
        <meta name="description" content="">

        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/mapmanager/css/syntax.css">
        <link rel="stylesheet" href="/mapmanager/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <div class=no-print>

<div style="float: right;"><A HREF="search.html">Search...</A></div>

<h4>
	<a class=brand href="/mapmanager/">Map Manager</a>
    <small></small>
</h4>


<!--
<div float=right>
<a href="javascript:window.print()" float=right>print</a>
</div>
-->



</div>

                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <!-- <li><a href="/mapmanager/">Home</a></li> -->
    <BR>
    
    
        
        

        
            
                <li class=nav-header>Workflows</li>
            
            <li data-order="1"><a href="/mapmanager/getting-started">Getting started</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/making-a-map">Making a map</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/annotating-a-stack">Annotating a stack</a></li>
        
    
        
        

        
            
                <li class=nav-header>Imaging Core</li>
            
            <li data-order="3"><a href="/mapmanager/stack-annotations">Stack Annotations</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/buttons">Buttons</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/stack">Stack</a></li>
        
    
        
        

        
            
                <li class=nav-header>Interface Windows</li>
            
            <li data-order="4"><a href="/mapmanager/point-list">Point List</a></li>
        
            
            <li data-order="5"><a href="/mapmanager/find-points-panel">Find Points</a></li>
        
            
            <li data-order="8"><a href="/mapmanager/hdd-paths">Hard Drive Paths</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/time-series-panel">Time Series</a></li>
        
            
            <li data-order="7"><a href="/mapmanager/stackdb-options-panel">Options</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/search-panel">Search</a></li>
        
            
            <li data-order="10"><a href="/mapmanager/plot-panel">Plot panel</a></li>
        
            
            <li data-order="9"><a href="/mapmanager/layout-panel">Layout panel</a></li>
        
            
            <li data-order="6"><a href="/mapmanager/contrast-panel">Contrast panel</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/stack-browser">Stack Browser</a></li>
        
    
        
        

        
            
                <li class=nav-header>Plots</li>
            
            <li data-order="1"><a href="/mapmanager/stack-plot">Stack plot</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/run-plot">Run plot</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/map-plot">Map plot</a></li>
        
    
        
        

        
            
                <li class=nav-header>Analysis</li>
            
            <li data-order="4"><a href="/mapmanager/Map-Pool">Map Pool</a></li>
        
            
            <li data-order="4"><a href="/mapmanager/Plotting">Plotting</a></li>
        
            
            <li data-order="3"><a href="/mapmanager/Algorithms">Algorithms</a></li>
        
            
            <li data-order="1"><a href="/mapmanager/reports">Reports</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/intensity">Intensity</a></li>
        
    
        
        

        
            
                <li class=nav-header>Blog Posts</li>
            
            <li data-order="2"><a href="/mapmanager/map-manager-matlab">Matlab class library</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/fiji-plugins">Fiji plugins</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/release-notes">Release Notes</a></li>
        
            
            <li data-order="5"><a href="/mapmanager/gallery">Gallery</a></li>
        
            
            <li data-order="2"><a href="/mapmanager/faq">FAQ</a></li>
        
            
            <li data-order=""><a href="/mapmanager/file-format">File format</a></li>
        
    


<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

<!--    <A HREF="search.html">Search...</A> -->

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h3>Stack Annotations
        
    </h3>
</div>

<p>3D Annotations are the core of Map Manager. They are easy to create, edit, and in a map to connect them between time-points. Annotations can be <a href="search-panel">searched</a>, <a href="map-plot">plotted</a>, and exported.</p>

<h3 id="creating-and-editing-3d-annotations">Creating and Editing 3D annotations</h3>

<p><img class="img-float-right" src="images/imagingcore/stack_db.png" width="500" /></p>

<h4 id="creating-an-annotation">Creating an annotation</h4>

<p>Shift+click in the image to create a new annotation. Remember, all annotations are 3D. Take care in choosing the imaging plane where you create an object. For spines, the point should mark the membrane limit near the tip of the spine.</p>

<h4 id="selecting-an-annotation">Selecting an annotation</h4>

<p>Single-click on an annotation to select it. The selected annotation is shown as a yellow circle. Only one annotation can be selected at a time. Keyboard <kbd>esc</kbd> will cancel the annotation selection.</p>

<h4 id="moving-an-annotation">Moving an annotation</h4>

<p>Select the annotation (single click), right-click and select ‘Move’. Your next click will be the new 3D position of the annotation. You are given feedback in the bottom of the stack window. Press keyboard <kbd>esc</kbd> to cancel a move.</p>

<h4 id="deleting-an-annotation">Deleting an annotation</h4>

<p>Select the annotation (single click), right-click and select ‘Delete’. Alternatively, select the annotation (single-click) and hit the <kbd>del</kbd> key.</p>

<p class="tip"><b>Tip.</b> All annotations are 3D points. When an annotation is created, the x/y position is specified by the position of the mouse cursor and the z position is the currently viewed image plane. To create a new point with better precision, zoom in the stack window with ctrl + mouse-wheel or keyboard '+'. As always, zooming will follow the mouse pointer.
</p>

<h4 id="tagging-annotations-with-bad-and-user-type">Tagging annotations with ‘bad’ and ‘user type’</h4>

<p>Each annotation can be marked with different tags. To see most of the tagging options, right-click a selected annotation and look at the contextual popup menu.</p>

<ul>
  <li>
    <h5 id="tagging-an-annotation-bad">Tagging an annotation ‘bad’</h5>
    <p>All annotations tagged with ‘bad’ will <strong>not</strong> be included in the analysis performed in <a href="reports">reports</a> and their visibility can be toggled in all <a href="map-plot">plots</a>. In general, stacks should be over annotated and ‘bad’ should be used to remove an annotation from the analysis but not from the database of annotations. In this way, as data sets grow (and time passes) when you return to something that looks promising (but is not), it will already have a ‘bad’ annotation.</p>
  </li>
  <li>
    <h5 id="tagging-and-annotation-with-a-user-type">Tagging and annotation with a ‘user type’</h5>
    <p>Each annotation can be tagged with one user type, from user type 1 through user type 10. This is useful for organizing annotations into different groups. Annotation user type can  be <a href="search-panel">searched</a>, used to plot subsets of annotations, and used to create a mask of annotations to overlay over a plot. For example, long spines cold be taged with ‘user type 1’ and then <a href="reports">reports</a> can be generated that break down the dynamics of all versus ‘user type 1’ spines.</p>
  </li>
</ul>

<h4 id="exporting-annotations">Exporting annotations</h4>

<p>It is very easy to export the 3D coordinates of annotations.</p>

<ul>
  <li>
    <p>Open the left control bar with keyboard <kbd>[</kbd>, click on the list of annotations and then press keyboard <kbd>e</kbd>. This will open a text table of all annotations in the stack, you can copy and paste it into your favorite analysis program. See <a href="reports">stack report</a> for more information.</p>
  </li>
  <li>
    <p>When you save a stack or a map, all the annotations in each stack is saved in a single text file. The file can be found in a folder named ‘stackdb’ in the hard-drive folder of your original stack. See <a href="file-format">File formats</a> for more information.</p>
  </li>
  <li>
    <p>We provide, <a href="map-manager-matlab">Map Manager - Matlab</a>, an easy to use Matlab class library that allows all Map Manager analysis to be extended using Matlab.</p>
  </li>
</ul>

<p><a id="creating-line-segments"></a></p>

<h3 id="creating-and-editing-line-segments">Creating and editing line segments</h3>

<p>Line segments are fit using a custom Fiji plugin from within Map Manager, there is no need to manually interact with Fiji. The path to Fiji does need to be set in the <a href="hdd-paths">hard drive paths</a> panel.</p>

<p>All the line segments in a stack are listed in the ‘Line Segment’ group. Each line segment has a length (um), a number of objects (nObj), a radius (r), and a color (c).</p>

<h4 id="creating-line-segments">Creating line segments</h4>

<ol>
  <li>Make sure ‘Segments’ edit checkbox is turned on. This is in the left control bar which can be opened with keyboard <kbd>[</kbd>.</li>
  <li>Create a new (empty) line segment<br />
  Click the <kbd>+</kbd> button in the ‘Segment’ group.</li>
  <li>Make a series of 3D <strong>control point</strong> annotations along a dendritic segment.
    <ul>
      <li>Shift-click in the image to create a <strong>control point</strong>.</li>
      <li>Continue making <strong>control points</strong> along the dendritic segment.</li>
    </ul>
  </li>
  <li>Fit the line segment in FIJI
    <ul>
      <li>Right-click on the new line segment (in the top left list of segment) and select ‘Make From Control Points - FIJI’. This will open the ‘Bob Neurite Tracer’ plugin in FIJI, fit a line to your <strong>control points</strong> and open the fitted line segment in the map manager stack window.</li>
    </ul>
  </li>
</ol>

<p><strong>Important:</strong> When making control points, they need to be in order along a segment. If you double-back a control point on the segment, the line fit with dumbly follow this ordering of control points. If it all gets confusing you can just delete all your control points and start over.</p>

<p><strong>Important:</strong> When making a map, you will be connecting (e.g. making persistent) individual line segments  from one timepoint to the next. For segments that you will connect together in a map, make sure your control points are in the same direction along each segment. If your control points go left to right in time-point 1, they should also go left to right in time-point 2.</p>

<h4 id="line-segment-radius">Line segment radius</h4>

<p>Each line segment has a fixed radius in um. Spines are connected to this radius. To change the radius, double-click the radius for a segment and enter a new number. The radius of each segment is displayed in the ‘r’ column. Setting the radius will reconnect all your spines to that new radius while preserving the spine connection point to the line. To set all the radii of a run of connected segments, right click on the segment in the list and select ‘Set run to same radius’.</p>

<h4 id="line-segment-pivot-points">Line segment pivot points</h4>

<p>When in a map, line segments need a ‘pivot point’. Specify a pivot point for a segment by clicking a point in the segment, right-click and select the ‘Set As Segment Pivot’ menu.</p>

<p>The pivot point should mark a region of the segment that is visually similar and identifiable in all time-points. A good strategy is to choose a region of the segment near a large spine that is present in all time-points. Another strategy is to choose a pivot point where some other segment (dendrite) crosses near your segment as these tend to remain stable across time. Try and put the pivot point near the center of the segment, do not place it at either end. The pivot point is used to calculate a line distance along the segment (in um) which in turn will be used to auto-guess connections between objects (spines) across time-points.</p>

<div class="print-page-break"></div>



<div class="post-tags">
  
  
  
    <b>Tags:</b>  
  
  
  
    <a href="/mapmanager/tags/#Imaging core">Imaging core</a>
  

   <!--
   <a href="javascript:window.print()">print</a>
    -->

   <!--
   <BR>
   <a href="_posts/2015-04-20-stack-annotations.pdf">print pdf</a>
   <BR>
   -->
    
</div>


                    </div>
                
            </div>

            

            <div class=row-fluid>
                <div id=footer class=span12>
                      Copyright &copy; 2017 - Robert Cudmore -

 <a href="http://robertcudmore.org/index.html">robertcudmore.org</a>

<!--
Documentation for <a href="https://github.com/cudmore/mapmanager">Map Manager</a>
-->
                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                    
                    //console.log(order, li);
                }

                //20160327 removed, this was no doing anything???
                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    //console.log(section);
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
